B1;95;0c#define Event_cxx
#define plotcck_cxx
//#include "plotcck.h"
#include "Event.h"

#include "TH1.h"
#include "TStopwatch.h"

#include <iostream>
#include <iomanip>
#include <fstream>

using namespace std;

void Event::Loop() {};
//void plotcck::Loop(){};
void ConvertToTrackTuple_alg_precut_debug(TString input_name, TString output_name);
//void precuts(TString s);
//vector <int> evt;


void ConvertToTrackTuple_alg_precut_debug()
{

  TStopwatch clock;

  /*
  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/assok_refined_KrecoAlg_parameter8_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/assok_rerunPID_tracktuple.root");
  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/singlek_refined_KrecoAlg_parameter8_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/singlek_rerunPID_tracktuple.root");
  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample0_refined_KrecoAlg_parameter8_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample0_rerunPID_tracktuple.root");
  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample1_refined_KrecoAlg_parameter8_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample1_rerunPID_tracktuple.root");
  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample2_refined_KrecoAlg_parameter8_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/numi_sample2_rerunPID_tracktuple.root");
  */

  ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/assok_refined_KrecoAlg_parameter10_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/assok_parameter10_rerunPID_tracktuple.root");
  //ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/singlek_refined_KrecoAlg_parameter10_rerunPID.root","/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/singlek_parameter10_rerunPID_tracktuple.root");

  //ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana_old/scan_fhc_run1_assok_match_roi20_debug6_max15_initial101_lsdis15_spineall_nospine_discon075_daughter40_lscon_ls_open23_peak3_min5_closest8_final50_prod.root", "rootfile/core.root");
  //ConvertToTrackTuple_alg_precut_debug("/exp/uboone/data/users/taniuchi/taniuchi/pandora_alg/ana/assok_refined_KrecoAlg_debug_2.root", "refine_debug_2.root");

  cout << "Real time " << clock.RealTime() << " s" << endl << endl;

}


void ConvertToTrackTuple_alg_precut_debug(TString input_name, TString output_name)
{

  // Input files
  TChain * t = new TChain("CCKaonAnalyzer/Event");
  //TChain * t = new TChain("CCKaonAnalyzerRebuild/Event");

  cout << "Input " << input_name << endl;

  //if root file                                                                                                                                                                                                                                 
  if (input_name.Contains(".root")) {
    t->Add(input_name);
  }
  //if list file                                                                                                                                                                                                                                 
  else if (input_name.Contains(".list")) {
    ifstream file_list(input_name.Data());
    while (file_list.good()) {
      string line;
      getline(file_list,line);
      if (!file_list.eof()) t->Add(line.c_str());
    }
  }
  else {
    cout << "unknown input" << endl;
    return;
  }

  // Output file
  TFile * outfile = new TFile(output_name, "recreate");
  TTree * outtree = new TTree("CCKaonTracks","CCKaonTracks");

  Int_t   true_kaon_ndaughters = -1;
  Int_t   true_kaon_end_process = -1;

  Int_t   reco_track_nhits0 = 0;
  Int_t   reco_track_nhits1 = 0;
  Int_t   reco_track_nhits2 = 0;
  
  Float_t reco_track_distance = -9999;
  Float_t reco_track_vtx_distance = -9999;
  Float_t reco_track_length = -9999;
  Float_t reco_track_theta = -9999;
  Float_t reco_track_phi = -9999;

  Float_t reco_track_chi2ka_pl0 = -9999;
  Float_t reco_track_chi2pr_pl0 = -9999;
  Float_t reco_track_chi2pi_pl0 = -9999;
  Float_t reco_track_chi2mu_pl0 = -9999;
  
  Float_t reco_track_chi2ka_pl1 = -9999;
  Float_t reco_track_chi2pr_pl1 = -9999;
  Float_t reco_track_chi2pi_pl1 = -9999;
  Float_t reco_track_chi2mu_pl1 = -9999;
  
  Float_t reco_track_chi2ka_pl2 = -9999;
  Float_t reco_track_chi2pr_pl2 = -9999;
  Float_t reco_track_chi2pi_pl2 = -9999;
  Float_t reco_track_chi2mu_pl2 = -9999;  
     
  Float_t reco_track_chi2ka_3pl = -9999;
  Float_t reco_track_chi2pr_3pl = -9999;
  Float_t reco_track_chi2pi_3pl = -9999;
  Float_t reco_track_chi2mu_3pl = -9999;
  
  Float_t reco_track_llrpid_3pl = -9999;  
  Float_t reco_track_llrpid_k_3pl = -9999;  
  Int_t   reco_track_true_pdg = -9999;
  
  Bool_t  reco_track_vtx_inTPC = 0;
  Bool_t  reco_track_vtx_in5cmTPC = 0;
  Bool_t  reco_track_vtx_inCCInclusiveTPC = 0;
  Bool_t  reco_track_end_inTPC = 0;
  Bool_t  reco_track_end_in5cmTPC = 0;
  Bool_t  reco_track_end_inCCInclusiveTPC = 0;
  
  Bool_t  reco_track_true_vtx_inTPC = 0;
  Bool_t  reco_track_true_vtx_in5cmTPC = 0;
  Bool_t  reco_track_true_vtx_inCCInclusiveTPC = 0;
  Bool_t  reco_track_true_end_inTPC = 0;
  Bool_t  reco_track_true_end_in5cmTPC = 0;
  Bool_t  reco_track_true_end_inCCInclusiveTPC = 0;
  
  
  Float_t reco_track_ndaughters_old = 0;  
  Float_t reco_track_daughter_old_distance = -9999;
  Float_t reco_track_daughter_old_true_pdg = -9999;
  Float_t reco_track_daughter_old_length = -9999;
  Float_t reco_track_daughter_old_theta = -9999;
  Float_t reco_track_daughter_old_phi = -9999;
  Float_t reco_track_daughter_old_chi2ka_pl0 = -9999;
  Float_t reco_track_daughter_old_chi2pr_pl0 = -9999;
  Float_t reco_track_daughter_old_chi2pi_pl0 = -9999;
  Float_t reco_track_daughter_old_chi2mu_pl0 = -9999;
  
  Float_t reco_track_daughter_old_chi2ka_pl1 = -9999;
  Float_t reco_track_daughter_old_chi2pr_pl1 = -9999;
  Float_t reco_track_daughter_old_chi2pi_pl1 = -9999;
  Float_t reco_track_daughter_old_chi2mu_pl1 = -9999;
  
  Float_t reco_track_daughter_old_chi2ka_pl2 = -9999;
  Float_t reco_track_daughter_old_chi2pr_pl2 = -9999;
  Float_t reco_track_daughter_old_chi2pi_pl2 = -9999;
  Float_t reco_track_daughter_old_chi2mu_pl2 = -9999;
  
  Float_t reco_track_daughter_old_chi2ka_3pl = -9999;
  Float_t reco_track_daughter_old_chi2pr_3pl = -9999;
  Float_t reco_track_daughter_old_chi2pi_3pl = -9999;
  Float_t reco_track_daughter_old_chi2mu_3pl = -9999;  
  Float_t reco_track_daughter_old_llrpid_3pl = -9999;
  Float_t reco_track_daughter_old_llrpid_k_3pl = -9999;
  
  Bool_t  reco_track_daughter_old_vtx_inTPC = 0;
  Bool_t  reco_track_daughter_old_vtx_in5cmTPC = 0;
  Bool_t  reco_track_daughter_old_vtx_inCCInclusiveTPC = 0;
  Bool_t  reco_track_daughter_old_end_inTPC = 0;
  Bool_t  reco_track_daughter_old_end_in5cmTPC = 0;
  Bool_t  reco_track_daughter_old_end_inCCInclusiveTPC = 0;


  Float_t reco_track_ndaughters = 0;  
  Float_t reco_track_daughter_length = -9999;
  Float_t reco_track_daughter_distance = -9999;
  Float_t reco_track_daughter_vtx_distance = -9999;
  Float_t reco_track_daughter_theta = -9999;
  Float_t reco_track_daughter_phi = -9999;
  
  Float_t reco_track_daughter_chi2ka_pl0 = -9999;
  Float_t reco_track_daughter_chi2pr_pl0 = -9999;
  Float_t reco_track_daughter_chi2pi_pl0 = -9999;
  Float_t reco_track_daughter_chi2mu_pl0 = -9999;
  
  Float_t reco_track_daughter_chi2ka_pl1 = -9999;
  Float_t reco_track_daughter_chi2pr_pl1 = -9999;
  Float_t reco_track_daughter_chi2pi_pl1 = -9999;
  Float_t reco_track_daughter_chi2mu_pl1 = -9999;
  
  Float_t reco_track_daughter_chi2ka_pl2 = -9999;
  Float_t reco_track_daughter_chi2pr_pl2 = -9999;
  Float_t reco_track_daughter_chi2pi_pl2 = -9999;
  Float_t reco_track_daughter_chi2mu_pl2 = -9999;
  
  Float_t reco_track_daughter_chi2ka_3pl = -9999;
  Float_t reco_track_daughter_chi2pr_3pl = -9999;
  Float_t reco_track_daughter_chi2pi_3pl = -9999;
  Float_t reco_track_daughter_chi2mu_3pl = -9999;
  
  Float_t reco_track_daughter_llrpid_3pl = -9999;
  Float_t reco_track_daughter_llrpid_k_3pl = -9999;
  Float_t reco_track_daughter_true_pdg = -9999;
  
  Bool_t  reco_track_daughter_vtx_inTPC = 0;
  Bool_t  reco_track_daughter_vtx_in5cmTPC = 0;
  Bool_t  reco_track_daughter_vtx_inCCInclusiveTPC = 0;
  Bool_t  reco_track_daughter_end_inTPC = 0;
  Bool_t  reco_track_daughter_end_in5cmTPC = 0;
  Bool_t  reco_track_daughter_end_inCCInclusiveTPC = 0;
  
  Bool_t  reco_track_daughter_true_vtx_inTPC = 0;
  Bool_t  reco_track_daughter_true_vtx_in5cmTPC = 0;
  Bool_t  reco_track_daughter_true_vtx_inCCInclusiveTPC = 0;
  Bool_t  reco_track_daughter_true_end_inTPC = 0;
  Bool_t  reco_track_daughter_true_end_in5cmTPC = 0;
  Bool_t  reco_track_daughter_true_end_inCCInclusiveTPC = 0;
  //Bool+y

  Float_t reco_track_Bragg_fwd_ka_pl0 = -9999;
  Float_t reco_track_Bragg_fwd_pr_pl0 = -9999;
  Float_t reco_track_Bragg_fwd_pi_pl0 = -9999;
  Float_t reco_track_Bragg_fwd_mu_pl0 = -9999;
  Float_t reco_track_Bragg_fwd_ka_pl1 = -9999;
  Float_t reco_track_Bragg_fwd_pr_pl1 = -9999;
  Float_t reco_track_Bragg_fwd_pi_pl1 = -9999;
  Float_t reco_track_Bragg_fwd_mu_pl1 = -9999;
  Float_t reco_track_Bragg_fwd_ka_pl2 = -9999;
  Float_t reco_track_Bragg_fwd_pr_pl2 = -9999;
  Float_t reco_track_Bragg_fwd_pi_pl2 = -9999;
  Float_t reco_track_Bragg_fwd_mu_pl2 = -9999;
  Float_t reco_track_MIP_pl0 = -9999;
  Float_t reco_track_MIP_pl1 = -9999;
  Float_t reco_track_MIP_pl2 = -9999;
   
  Float_t reco_track_braggLLH = -9999;
   
  Float_t reco_angle_track_daughter = -9999;
  Float_t reco_track_log_bragg_peak = -9999;
  
  Float_t reco_nu_ndaughters = -9999;
  
  Float_t reco_track_delta_dEdx_pl0 = -9999;
  Float_t reco_track_delta_dEdx_pl1 = -9999;
  Float_t reco_track_delta_dEdx_pl2 = -9999;


  Float_t         true_nu_energy = -9999;
  Float_t         true_kaon_p = -9999;
  Float_t         true_kaon_ke = -9999;
  Float_t         true_kaon_theta = -9999;
  Float_t         true_kaon_costheta = -9999;
  Float_t         true_kaon_phi = -9999;
  Float_t         true_kaon_length = -9999;
  Float_t         true_kaon_daughter_length = -9999;

  Float_t true_dau_pip_length = -9999;
  Float_t true_dau_muon_length = -9999;

  Int_t         true_nu_ccnc = -9999;
  Int_t         true_nu_pdg = -9999;
  Int_t         true_nu_mode = -9999;
  Int_t         true_lepton_pdg = -9999;
  Int_t         true_nkaons = -9999;
  Int_t         true_nhyperons = -9999;
  //Int_t         true_kaon_ndaughters = -9999;
  Int_t         true_kaon_ndaughters_inelastic = -9999;
  Int_t         reco_ccmu_true_pdg = -9999;
  Int_t         eventnum = -9999;
  Int_t         run = -9999;
  Int_t         subrun = -9999;

  Int_t true_kaon_daughter_end_in5cmTPC = -9999;
  Int_t true_kaon_end_inCCInclusiveTPC = -9999;
  Int_t true_nu_vtx_inCCInclusiveTPC = -9999;

  Float_t reco_track_kin0 = -9999;
  Float_t reco_track_kin1 = -9999;
  Float_t reco_track_kin2 = -9999;

  Float_t reco_track_P_vtx = -9999;  // track.VertexMomentum
  Float_t reco_track_P_str = -9999;  // track.StartMomentum()
  Float_t reco_track_P_end = -9999;  // track.EndMomentum();

  Int_t n_true_k=0;
  //Int_t           reco_track_true_pdg = -9999;
  //Int_t           reco_track_daughter_true_pdg = -9999;


  outtree->Branch("true_nu_energy",&true_nu_energy,"true_nu_energy/F");
  outtree->Branch("true_kaon_p",&true_kaon_p,"true_kaon_p/F");
  outtree->Branch("true_kaon_ke",&true_kaon_ke,"true_kaon_ke/F");
  outtree->Branch("true_kaon_theta",&true_kaon_theta,"true_kaon_theta/F");
  outtree->Branch("true_kaon_costheta",&true_kaon_costheta,"true_kaon_costheta/F");
  outtree->Branch("true_kaon_phi",&true_kaon_phi,"true_kaon_phi/F");
  outtree->Branch("true_kaon_length",&true_kaon_length,"true_kaon_length/F");
  outtree->Branch("true_kaon_daughter_length",&true_kaon_daughter_length,"true_kaon_daughter_length/F");

  outtree->Branch("true_dau_pip_length",&true_dau_pip_length,"true_dau_pip_length/F"); 
  outtree->Branch("true_dau_muon_length",&true_dau_muon_length,"true_dau_muon_length/F"); 

  outtree->Branch("eventnum", &eventnum, "eventnum/I"); 
  outtree->Branch("run", &run, "run/I"); 
  outtree->Branch("subrun", &subrun, "subrun/I"); 
  outtree->Branch("true_nu_pdg", &true_nu_pdg, "true_nu_pdg/I"); 
  outtree->Branch("true_nu_ccnc", &true_nu_ccnc, "true_nu_ccnc/I"); 
  outtree->Branch("true_nu_mode", &true_nu_mode, "true_nu_mode/I"); 
  outtree->Branch("true_lepton_pdg", &true_lepton_pdg, "true_lepton_pdg/I"); 
  outtree->Branch("true_nkaons", &true_nkaons, "true_nkaons/I"); 
  outtree->Branch("true_nhyperons", &true_nhyperons, "true_nhyperons/I"); 
  outtree->Branch("true_kaon_ndaughters_inelastic", &true_kaon_ndaughters_inelastic, "true_kaon_ndaughters_inelastic/I");
  outtree->Branch("reco_ccmu_true_pdg", &reco_ccmu_true_pdg, "reco_ccmu_true_pdg/I"); 

  //outtree->Branch("reco_track_true_pdg",&reco_track_true_pdg,"reco_track_true_pdg/I");
  //outtree->Branch("reco_track_daughter_true_pdg",&reco_track_daughter_true_pdg,"reco_track_daughter_true_pdg/I");

  outtree->Branch("true_kaon_end_inCCInclusiveTPC",&true_kaon_end_inCCInclusiveTPC,"true_kaon_end_inCCInclusiveTPC/I");
  outtree->Branch("true_nu_vtx_inCCInclusiveTPC",&true_nu_vtx_inCCInclusiveTPC,"true_nu_vtx_inCCInclusiveTPC/I");
  outtree->Branch("true_kaon_daughter_end_in5cmTPC",&true_kaon_daughter_end_in5cmTPC,"true_kaon_daughter_end_in5cmTPC/I");
  
  outtree->Branch("true_kaon_end_process",&true_kaon_end_process,"true_kaon_end_process/I");
  outtree->Branch("reco_track_nhits0",&reco_track_nhits0,"reco_track_nhits0/I");
  outtree->Branch("reco_track_nhits1",&reco_track_nhits1,"reco_track_nhits1/I");
  outtree->Branch("reco_track_nhits2",&reco_track_nhits2,"reco_track_nhits2/I");

  outtree->Branch("reco_track_distance",&reco_track_distance,"reco_track_distance/F");
  outtree->Branch("reco_track_vtx_distance",&reco_track_vtx_distance,"reco_track_vtx_distance/F");
  outtree->Branch("reco_track_length",&reco_track_length,"reco_track_length/F");
  outtree->Branch("reco_track_theta",&reco_track_theta,"reco_track_theta/F");
  outtree->Branch("reco_track_phi",&reco_track_phi,"reco_track_phi/F");
  
  outtree->Branch("reco_track_log_bragg_peak",&reco_track_log_bragg_peak,"reco_track_log_bragg_peak/F");
  outtree->Branch("reco_track_Bragg_fwd_ka_pl0",&reco_track_Bragg_fwd_ka_pl0,"reco_track_Bragg_fwd_ka_pl0/F");  
  outtree->Branch("reco_track_Bragg_fwd_pr_pl0",&reco_track_Bragg_fwd_pr_pl0,"reco_track_Bragg_fwd_pr_pl0/F");  
  outtree->Branch("reco_track_Bragg_fwd_pi_pl0",&reco_track_Bragg_fwd_pi_pl0,"reco_track_Bragg_fwd_pi_pl0/F");  
  outtree->Branch("reco_track_Bragg_fwd_mu_pl0",&reco_track_Bragg_fwd_mu_pl0,"reco_track_Bragg_fwd_mu_pl0/F");  
  outtree->Branch("reco_track_Bragg_fwd_ka_pl1",&reco_track_Bragg_fwd_ka_pl1,"reco_track_Bragg_fwd_ka_pl1/F");  
  outtree->Branch("reco_track_Bragg_fwd_pr_pl1",&reco_track_Bragg_fwd_pr_pl1,"reco_track_Bragg_fwd_pr_pl1/F");  
  outtree->Branch("reco_track_Bragg_fwd_pi_pl1",&reco_track_Bragg_fwd_pi_pl1,"reco_track_Bragg_fwd_pi_pl1/F");  
  outtree->Branch("reco_track_Bragg_fwd_mu_pl1",&reco_track_Bragg_fwd_mu_pl1,"reco_track_Bragg_fwd_mu_pl1/F");  
  outtree->Branch("reco_track_Bragg_fwd_ka_pl2",&reco_track_Bragg_fwd_ka_pl2,"reco_track_Bragg_fwd_ka_pl2/F");  
  outtree->Branch("reco_track_Bragg_fwd_pr_pl2",&reco_track_Bragg_fwd_pr_pl2,"reco_track_Bragg_fwd_pr_pl2/F");  
  outtree->Branch("reco_track_Bragg_fwd_pi_pl2",&reco_track_Bragg_fwd_pi_pl2,"reco_track_Bragg_fwd_pi_pl2/F");  
  outtree->Branch("reco_track_Bragg_fwd_mu_pl2",&reco_track_Bragg_fwd_mu_pl2,"reco_track_Bragg_fwd_mu_pl2/F");  

  outtree->Branch("reco_track_MIP_pl0",&reco_track_MIP_pl0,"reco_track_MIP_pl0/F");
  outtree->Branch("reco_track_MIP_pl1",&reco_track_MIP_pl0,"reco_track_MIP_pl1/F");
  outtree->Branch("reco_track_MIP_pl2",&reco_track_MIP_pl0,"reco_track_MIP_pl2/F");
  
  outtree->Branch("reco_track_chi2ka_pl0",&reco_track_chi2ka_pl0,"reco_track_chi2ka_pl0/F");
  outtree->Branch("reco_track_chi2pr_pl0",&reco_track_chi2pr_pl0,"reco_track_chi2pr_pl0/F");
  outtree->Branch("reco_track_chi2pi_pl0",&reco_track_chi2pi_pl0,"reco_track_chi2pi_pl0/F");
  outtree->Branch("reco_track_chi2mu_pl0",&reco_track_chi2mu_pl0,"reco_track_chi2mu_pl0/F");
  
  outtree->Branch("reco_track_chi2ka_pl1",&reco_track_chi2ka_pl1,"reco_track_chi2ka_pl1/F");
  outtree->Branch("reco_track_chi2pr_pl1",&reco_track_chi2pr_pl1,"reco_track_chi2pr_pl1/F");
  outtree->Branch("reco_track_chi2pi_pl1",&reco_track_chi2pi_pl1,"reco_track_chi2pi_pl1/F");
  outtree->Branch("reco_track_chi2mu_pl1",&reco_track_chi2mu_pl1,"reco_track_chi2mu_pl1/F");
  
  outtree->Branch("reco_track_chi2ka_pl2",&reco_track_chi2ka_pl2,"reco_track_chi2ka_pl2/F");
  outtree->Branch("reco_track_chi2pr_pl2",&reco_track_chi2pr_pl2,"reco_track_chi2pr_pl2/F");
  outtree->Branch("reco_track_chi2pi_pl2",&reco_track_chi2pi_pl2,"reco_track_chi2pi_pl2/F");
  outtree->Branch("reco_track_chi2mu_pl2",&reco_track_chi2mu_pl2,"reco_track_chi2mu_pl2/F");
  
  
  outtree->Branch("reco_track_chi2ka_3pl",&reco_track_chi2ka_3pl,"reco_track_chi2ka_3pl/F");
  outtree->Branch("reco_track_chi2pr_3pl",&reco_track_chi2pr_3pl,"reco_track_chi2pr_3pl/F");
  outtree->Branch("reco_track_chi2pi_3pl",&reco_track_chi2pi_3pl,"reco_track_chi2pi_3pl/F");
  outtree->Branch("reco_track_chi2mu_3pl",&reco_track_chi2mu_3pl,"reco_track_chi2mu_3pl/F");
 

  outtree->Branch("reco_track_delta_dEdx_pl0",&reco_track_delta_dEdx_pl0,"reco_track_delta_dEdx_pl0/F");
  outtree->Branch("reco_track_delta_dEdx_pl1",&reco_track_delta_dEdx_pl1,"reco_track_delta_dEdx_pl1/F");
  outtree->Branch("reco_track_delta_dEdx_pl2",&reco_track_delta_dEdx_pl2,"reco_track_delta_dEdx_pl2/F");

  outtree->Branch("reco_track_llrpid_3pl",&reco_track_llrpid_3pl,"reco_track_llrpid_3pl/F");
  outtree->Branch("reco_track_llrpid_k_3pl",&reco_track_llrpid_k_3pl,"reco_track_llrpid_k_3pl/F");
  outtree->Branch("reco_track_true_pdg",&reco_track_true_pdg,"reco_track_true_pdg/I");
  
  outtree->Branch("reco_track_vtx_inTPC",&reco_track_vtx_inTPC,"reco_track_vtx_inTPC/O");
  outtree->Branch("reco_track_vtx_in5cmTPC",&reco_track_vtx_in5cmTPC,"reco_track_vtx_in5cmTPC/O");
  outtree->Branch("reco_track_vtx_inCCInclusiveTPC",&reco_track_vtx_inCCInclusiveTPC,"reco_track_vtx_inCCInclusiveTPC/O");
  outtree->Branch("reco_track_end_inTPC",&reco_track_end_inTPC,"reco_track_end_inTPC/O");
  outtree->Branch("reco_track_end_in5cmTPC",&reco_track_end_in5cmTPC,"reco_track_end_in5cmTPC/O");
  outtree->Branch("reco_track_end_inCCInclusiveTPC",&reco_track_end_inCCInclusiveTPC,"reco_track_end_inCCInclusiveTPC/O");
  
  outtree->Branch("reco_track_true_vtx_inTPC",&reco_track_true_vtx_inTPC,"reco_track_true_vtx_inTPC/O");
  outtree->Branch("reco_track_true_vtx_in5cmTPC",&reco_track_true_vtx_in5cmTPC,"reco_track_true_vtx_in5cmTPC/O");
  outtree->Branch("reco_track_true_vtx_inCCInclusiveTPC",&reco_track_true_vtx_inCCInclusiveTPC,"reco_track_true_vtx_inCCInclusiveTPC/O");
  outtree->Branch("reco_track_true_end_inTPC",&reco_track_true_end_inTPC,"reco_track_true_end_inTPC/O");
  outtree->Branch("reco_track_true_end_in5cmTPC",&reco_track_true_end_in5cmTPC,"reco_track_true_end_in5cmTPC/O");
  outtree->Branch("reco_track_true_end_inCCInclusiveTPC",&reco_track_true_end_inCCInclusiveTPC,"reco_track_true_end_inCCInclusiveTPC/O");


  outtree->Branch("reco_track_ndaughters",&reco_track_ndaughters,"reco_track_ndaughters/F");    
  outtree->Branch("reco_track_daughter_length",&reco_track_daughter_length,"reco_track_daughter_length/F");
  outtree->Branch("reco_track_daughter_distance",&reco_track_daughter_distance,"reco_track_daughter_distance/F");
  outtree->Branch("reco_track_daughter_vtx_distance",&reco_track_daughter_vtx_distance,"reco_track_daughter_vtx_distance/F");
  outtree->Branch("reco_track_daughter_theta",&reco_track_daughter_theta,"reco_track_daughter_theta/F");
  outtree->Branch("reco_track_daughter_phi",&reco_track_daughter_phi,"reco_track_daughter_phi/F");  
  outtree->Branch("reco_angle_track_daughter",&reco_angle_track_daughter,"reco_angle_track_daughter/F");
  
  outtree->Branch("reco_track_daughter_chi2ka_pl0",&reco_track_daughter_chi2ka_pl0,"reco_track_daughter_chi2ka_pl0/F");
  outtree->Branch("reco_track_daughter_chi2pr_pl0",&reco_track_daughter_chi2pr_pl0,"reco_track_daughter_chi2pr_pl0/F");
  outtree->Branch("reco_track_daughter_chi2pi_pl0",&reco_track_daughter_chi2pi_pl0,"reco_track_daughter_chi2pi_pl0/F");
  outtree->Branch("reco_track_daughter_chi2mu_pl0",&reco_track_daughter_chi2mu_pl0,"reco_track_daughter_chi2mu_pl0/F");
  
  outtree->Branch("reco_track_daughter_chi2ka_pl1",&reco_track_daughter_chi2ka_pl1,"reco_track_daughter_chi2ka_pl1/F");
  outtree->Branch("reco_track_daughter_chi2pr_pl1",&reco_track_daughter_chi2pr_pl1,"reco_track_daughter_chi2pr_pl1/F");
  outtree->Branch("reco_track_daughter_chi2pi_pl1",&reco_track_daughter_chi2pi_pl1,"reco_track_daughter_chi2pi_pl1/F");
  outtree->Branch("reco_track_daughter_chi2mu_pl1",&reco_track_daughter_chi2mu_pl1,"reco_track_daughter_chi2mu_pl1/F");
  
  outtree->Branch("reco_track_daughter_chi2ka_pl2",&reco_track_daughter_chi2ka_pl2,"reco_track_daughter_chi2ka_pl2/F");
  outtree->Branch("reco_track_daughter_chi2pr_pl2",&reco_track_daughter_chi2pr_pl2,"reco_track_daughter_chi2pr_pl2/F");
  outtree->Branch("reco_track_daughter_chi2pi_pl2",&reco_track_daughter_chi2pi_pl2,"reco_track_daughter_chi2pi_pl2/F");
  outtree->Branch("reco_track_daughter_chi2mu_pl2",&reco_track_daughter_chi2mu_pl2,"reco_track_daughter_chi2mu_pl2/F");
  
  outtree->Branch("reco_track_daughter_chi2ka_3pl",&reco_track_daughter_chi2ka_3pl,"reco_track_daughter_chi2ka_3pl/F");
  outtree->Branch("reco_track_daughter_chi2pr_3pl",&reco_track_daughter_chi2pr_3pl,"reco_track_daughter_chi2pr_3pl/F");
  outtree->Branch("reco_track_daughter_chi2pi_3pl",&reco_track_daughter_chi2pi_3pl,"reco_track_daughter_chi2pi_3pl/F");
  outtree->Branch("reco_track_daughter_chi2mu_3pl",&reco_track_daughter_chi2mu_3pl,"reco_track_daughter_chi2mu_3pl/F");

  outtree->Branch("reco_track_daughter_llrpid_3pl",&reco_track_daughter_llrpid_3pl,"reco_track_daughter_llrpid_3pl/F");  
  outtree->Branch("reco_track_daughter_llrpid_k_3pl",&reco_track_daughter_llrpid_k_3pl,"reco_track_daughter_llrpid_k_3pl/F");  
  outtree->Branch("reco_track_daughter_true_pdg",&reco_track_daughter_true_pdg,"reco_track_daughter_true_pdg/F");  
  outtree->Branch("reco_track_daughter_vtx_inTPC",&reco_track_daughter_vtx_inTPC,"reco_track_daughter_vtx_inTPC/O");
  outtree->Branch("reco_track_daughter_vtx_in5cmTPC",&reco_track_daughter_vtx_in5cmTPC,"reco_track_daughter_vtx_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_vtx_inCCInclusiveTPC",&reco_track_daughter_vtx_inCCInclusiveTPC,"reco_track_daughter_vtx_inCCInclusiveTPC/O");
  outtree->Branch("reco_track_daughter_end_inTPC",&reco_track_daughter_end_inTPC,"reco_track_daughter_end_inTPC/O");
  outtree->Branch("reco_track_daughter_end_in5cmTPC",&reco_track_daughter_end_in5cmTPC,"reco_track_daughter_end_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_end_inCCInclusiveTPC",&reco_track_daughter_end_inCCInclusiveTPC,"reco_track_daughter_end_inCCInclusiveTPC/O");
  
  outtree->Branch("reco_track_daughter_true_vtx_inTPC",&reco_track_daughter_true_vtx_inTPC,"reco_track_daughter_true_vtx_inTPC/O");
  outtree->Branch("reco_track_daughter_true_vtx_in5cmTPC",&reco_track_daughter_true_vtx_in5cmTPC,"reco_track_daughter_true_vtx_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_true_vtx_inCCInclusiveTPC",&reco_track_daughter_true_vtx_inCCInclusiveTPC,"reco_track_daughter_true_vtx_inCCInclusiveTPC/O");
  outtree->Branch("reco_track_daughter_true_end_inTPC",&reco_track_daughter_true_end_inTPC,"reco_track_daughter_true_end_inTPC/O");
  outtree->Branch("reco_track_daughter_true_end_in5cmTPC",&reco_track_daughter_true_end_in5cmTPC,"reco_track_daughter_true_end_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_true_end_inCCInclusiveTPC",&reco_track_daughter_true_end_inCCInclusiveTPC,"reco_track_daughter_true_end_inCCInclusiveTPC/O");

  outtree->Branch("reco_track_kin0",&reco_track_kin0,"reco_track_kin0/F");
  outtree->Branch("reco_track_kin1",&reco_track_kin1,"reco_track_kin1/F");
  outtree->Branch("reco_track_kin2",&reco_track_kin2,"reco_track_kin2/F");

  outtree->Branch("reco_track_P_vtx",&reco_track_P_vtx,"reco_track_P_vtx/F");
  outtree->Branch("reco_track_P_str",&reco_track_P_str,"reco_track_P_str/F");
  outtree->Branch("reco_track_P_end",&reco_track_P_end,"reco_track_P_end/F");

  
  outtree->Branch("reco_track_ndaughters_old",&reco_track_ndaughters_old,"reco_track_ndaughters_old/F");    
  outtree->Branch("reco_track_daughter_old_length",&reco_track_daughter_old_length,"reco_track_daughter_old_length/F");
  outtree->Branch("reco_track_daughter_old_distance",&reco_track_daughter_old_distance,"reco_track_daughter_old_distance/F");
  outtree->Branch("reco_track_daughter_old_theta",&reco_track_daughter_old_theta,"reco_track_daughter_old_theta/F");
  outtree->Branch("reco_track_daughter_old_phi",&reco_track_daughter_old_phi,"reco_track_daughter_old_phi/F");  

  outtree->Branch("reco_track_daughter_old_chi2ka_pl0",&reco_track_daughter_old_chi2ka_pl0,"reco_track_daughter_old_chi2ka_pl0/F");
  outtree->Branch("reco_track_daughter_old_chi2pr_pl0",&reco_track_daughter_old_chi2pr_pl0,"reco_track_daughter_old_chi2pr_pl0/F");
  outtree->Branch("reco_track_daughter_old_chi2pi_pl0",&reco_track_daughter_old_chi2pi_pl0,"reco_track_daughter_old_chi2pi_pl0/F");
  outtree->Branch("reco_track_daughter_old_chi2mu_pl0",&reco_track_daughter_old_chi2mu_pl0,"reco_track_daughter_old_chi2mu_pl0/F");
  
  outtree->Branch("reco_track_daughter_old_chi2ka_pl1",&reco_track_daughter_old_chi2ka_pl1,"reco_track_daughter_old_chi2ka_pl1/F");
  outtree->Branch("reco_track_daughter_old_chi2pr_pl1",&reco_track_daughter_old_chi2pr_pl1,"reco_track_daughter_old_chi2pr_pl1/F");
  outtree->Branch("reco_track_daughter_old_chi2pi_pl1",&reco_track_daughter_old_chi2pi_pl1,"reco_track_daughter_old_chi2pi_pl1/F");
  outtree->Branch("reco_track_daughter_old_chi2mu_pl1",&reco_track_daughter_old_chi2mu_pl1,"reco_track_daughter_old_chi2mu_pl1/F");
  
  outtree->Branch("reco_track_daughter_old_chi2ka_pl2",&reco_track_daughter_old_chi2ka_pl2,"reco_track_daughter_old_chi2ka_pl2/F");
  outtree->Branch("reco_track_daughter_old_chi2pr_pl2",&reco_track_daughter_old_chi2pr_pl2,"reco_track_daughter_old_chi2pr_pl2/F");
  outtree->Branch("reco_track_daughter_old_chi2pi_pl2",&reco_track_daughter_old_chi2pi_pl2,"reco_track_daughter_old_chi2pi_pl2/F");
  outtree->Branch("reco_track_daughter_old_chi2mu_pl2",&reco_track_daughter_old_chi2mu_pl2,"reco_track_daughter_old_chi2mu_pl2/F");
  
  outtree->Branch("reco_track_daughter_old_chi2ka_3pl",&reco_track_daughter_old_chi2ka_3pl,"reco_track_daughter_old_chi2ka_3pl/F");
  outtree->Branch("reco_track_daughter_old_chi2pr_3pl",&reco_track_daughter_old_chi2pr_3pl,"reco_track_daughter_old_chi2pr_3pl/F");
  outtree->Branch("reco_track_daughter_old_chi2pi_3pl",&reco_track_daughter_old_chi2pi_3pl,"reco_track_daughter_old_chi2pi_3pl/F");
  outtree->Branch("reco_track_daughter_old_chi2mu_3pl",&reco_track_daughter_old_chi2mu_3pl,"reco_track_daughter_old_chi2mu_3pl/F");

  outtree->Branch("reco_track_daughter_old_llrpid_3pl",&reco_track_daughter_old_llrpid_3pl,"reco_track_daughter_old_llrpid_3pl/F");  
  outtree->Branch("reco_track_daughter_old_llrpid_k_3pl",&reco_track_daughter_old_llrpid_k_3pl,"reco_track_daughter_old_llrpid_k_3pl/F");  
  outtree->Branch("reco_track_daughter_old_true_pdg",&reco_track_daughter_old_true_pdg,"reco_track_daughter_old_true_pdg/F");  
  outtree->Branch("reco_track_daughter_old_vtx_inTPC",&reco_track_daughter_old_vtx_inTPC,"reco_track_daughter_old_vtx_inTPC/O");
  outtree->Branch("reco_track_daughter_old_vtx_in5cmTPC",&reco_track_daughter_old_vtx_in5cmTPC,"reco_track_daughter_old_vtx_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_old_vtx_inCCInclusiveTPC",&reco_track_daughter_old_vtx_inCCInclusiveTPC,"reco_track_daughter_old_vtx_inCCInclusiveTPC/O");
  outtree->Branch("reco_track_daughter_old_end_inTPC",&reco_track_daughter_old_end_inTPC,"reco_track_daughter_old_end_inTPC/O");
  outtree->Branch("reco_track_daughter_old_end_in5cmTPC",&reco_track_daughter_old_end_in5cmTPC,"reco_track_daughter_old_end_in5cmTPC/O");
  outtree->Branch("reco_track_daughter_old_end_inCCInclusiveTPC",&reco_track_daughter_old_end_inCCInclusiveTPC,"reco_track_daughter_old_end_inCCInclusiveTPC/O");
  


  // Loop over tree
  Long64_t nentries = t->GetEntries();
  cout << "Tree entries " << nentries << endl;

  Event event(t);
  //plotcck event(t);

  //for(Long64_t ev = 0; ev < evt.size(); ev++){

  Int_t true_cut1 = 0;
  Int_t true_cut2 = 0;
  Int_t true_cut3 = 0;

  //event.GetEntry(evt[ev]);
  //for (Long64_t jentry=0; jentry<1000; jentry++) {
    for (Long64_t jentry=0; jentry<nentries; jentry++) {
   
    event.GetEntry(jentry);
    if(nentries>=10){
      if (jentry%int(nentries/10.) == 0) {
	cout << int(100.*jentry/nentries) << " %" << endl;
      }
    }



    //FHC: 23 October 2015 - 2 May 2016 | run.sub 0 - 6748.22
    //RHC: 29 June 2016 - 29 July 2016 | run.sub 6748.22 - 7001
    //remove RHC runs
    /*
    if(event.run >= 6748 && event.run <= 7001){
      if(!(event.run == 6748 && event.subrun <= 21)) continue;
      //else continue;
    }
    */
    

    if(event.true_nu_pdg==14 && event.true_nu_ccnc==0 && (event.true_kaon_end_process==0 || event.true_kaon_end_process==1)  && event.true_kaon_ke>=0 && event.true_nu_vtx_inCCInclusiveTPC==true && event.true_kaon_end_inCCInclusiveTPC==true && event.true_kaon_daughter_end_in5cmTPC==true) n_true_k++;
    //if(event.true_kaon_end_process>=0) n_true_k++;
    //if(jentry%2 == 1) continue;


    if (event.reco_nu_cc_filter==false) continue;    
    if (event.reco_nu_vtx_inCCInclusiveTPC==false) continue;

    
    if(event.true_nu_pdg==14 && event.true_nu_ccnc==0 && event.true_kaon_ke>=0 && event.true_nu_vtx_inCCInclusiveTPC==true){
      true_cut1++;
      if(event.true_kaon_end_inCCInclusiveTPC==true){
	true_cut2++;
	if(event.true_kaon_daughter_end_in5cmTPC==true){
	  true_cut3++;
	}
      }    
    }
    

    //if(event.run==5025 || event.subrun==134 || event.event==6738) cout << "num_tracks: " << event.reco_ntracks << endl;

    //std::cout << "event.run: " << event.run << ", event.subrun: " << event.subrun << ", event.event: " << event.event << std::endl;

    // Loop over tracks 
    for (int itrk=0;itrk<event.reco_ntracks;itrk++) {

      //if(event.run==5025 || event.subrun==134 || event.event==6738){
      /*
	if(event.true_nu_pdg==14 && event.true_nu_ccnc==0 && event.true_kaon_ke>=0 && event.true_nu_vtx_inCCInclusiveTPC==true){
	  cout << "num_tracks: " << event.reco_ntracks << endl;
	  cout << itrk << "-th track pdg: " << event.reco_track_true_pdg[itrk] << endl;
	}
*/
	//}

      /*
      if(event.reco_track_true_pdg[itrk]==321 && ( event.reco_track_daughter_true_pdg[itrk][0]==-13 || event.reco_track_daughter_true_pdg[itrk][0]==211)  && event.true_nu_vtx_inCCInclusiveTPC==true){
	true_cut1++;
	if(event.true_kaon_end_inCCInclusiveTPC==true){
	  true_cut2++;
	  if(event.true_kaon_daughter_end_in5cmTPC==true){
	    true_cut3++;
	  }
	}    
      }
      */
      /*
      if(event.reco_track_true_pdg[itrk]==321 && ( event.reco_track_daughter_true_pdg[itrk][0]==-13 || event.reco_track_daughter_true_pdg[itrk][0]==211)  && event.reco_nu_vtx_inCCInclusiveTPC==true){
	true_cut1++;
	if(event.reco_track_end_inCCInclusiveTPC[itrk]==true){
	  true_cut2++;
	  if(event.reco_track_ndaughters[itrk]==1 && event.reco_track_daughter_end_in5cmTPC[itrk][0]==true){
	    true_cut3++;
	  }
	}    
      }
      */

      /*
      if(event.reco_track_nhits2[itrk]>0){
	if(event.reco_track_MIP_pl2[itrk]>0.06) continue;
      }else{
	if(event.reco_track_nhits0[itrk]>event.reco_track_nhits1[itrk]){
	  if(event.reco_track_MIP_pl0[itrk]>0.06) continue;
	}
	else if(event.reco_track_MIP_pl1[itrk]>0.06) continue;
      }
      */

      if(event.reco_track_end_inCCInclusiveTPC[itrk]==false) continue;


      double max_dau_length = -1;
      int max_dau_length_index = -1;
      
      for (int idau=0;idau<event.reco_track_ndaughters[itrk];idau++) {
	if(event.reco_track_daughter_length[itrk][idau]>max_dau_length){
	  max_dau_length = event.reco_track_daughter_length[itrk][idau];
	  max_dau_length_index = idau;
	}
      }

      /*
      if(event.reco_track_daughter_true_pdg[itrk][max_dau_length_index]==211){
	cout << "event.rebdautrack_length[itrk][idau]: " << event.reco_track_daughter_length[itrk][max_dau_length_index] << endl;
	cout << "event.reco_track_daughter_old_true_pdg[itrk][0]: " << event.reco_track_daughter_old_true_pdg[itrk][0] << ", event.reco_track_daughter_old_length[itrk][0]" << event.reco_track_daughter_old_length[itrk][0] << endl;
	cout << "before store reco_track_daughter_old_true_pdg: " << reco_track_daughter_old_true_pdg << ", reco_track_daughter_old_length" << reco_track_daughter_old_length << endl;
      }
      */
      /*
      if(max_dau_length_index>=0){
	cout << "reco_track_true_pdg: " << reco_track_true_pdg << endl;
	cout << "itrk: " << itrk << ", idau: " << max_dau_length_index  <<  ", event.rebdautrack_length[itrk][idau]: " << event.reco_track_daughter_length[itrk][max_dau_length_index] << endl;
      }
      */

      //cout << event.reco_track_daughter_old_length[itrk][0] << endl;
      //if(event.reco_track_daughter_old_length[itrk][0]>40){
      if(event.reco_track_daughter_old_length[itrk][0]>0 || event.reco_track_ndaughters[itrk]>0){
      if(event.reco_track_daughter_old_length[itrk][0]>0){

	if (event.reco_track_daughter_old_end_in5cmTPC[itrk][0]==false) continue;
	reco_track_daughter_old_length = event.reco_track_daughter_old_length[itrk][0];
	reco_track_daughter_old_distance = event.reco_track_daughter_old_distance[itrk][0];
	reco_track_daughter_old_theta = event.reco_track_daughter_old_theta[itrk][0];
	reco_track_daughter_old_phi = event.reco_track_daughter_old_phi[itrk][0];
	
	reco_track_daughter_old_chi2ka_pl0 = event.reco_track_daughter_old_chi2ka_pl0[itrk][0];
	reco_track_daughter_old_chi2pr_pl0 = event.reco_track_daughter_old_chi2pr_pl0[itrk][0];
	reco_track_daughter_old_chi2pi_pl0 = event.reco_track_daughter_old_chi2pi_pl0[itrk][0];
	reco_track_daughter_old_chi2mu_pl0 = event.reco_track_daughter_old_chi2mu_pl0[itrk][0];
	
	reco_track_daughter_old_chi2ka_pl1 = event.reco_track_daughter_old_chi2ka_pl1[itrk][0];
	reco_track_daughter_old_chi2pr_pl1 = event.reco_track_daughter_old_chi2pr_pl1[itrk][0];
	reco_track_daughter_old_chi2pi_pl1 = event.reco_track_daughter_old_chi2pi_pl1[itrk][0];
	reco_track_daughter_old_chi2mu_pl1 = event.reco_track_daughter_old_chi2mu_pl1[itrk][0];
	
	reco_track_daughter_old_chi2ka_pl2 = event.reco_track_daughter_old_chi2ka_pl2[itrk][0];
	reco_track_daughter_old_chi2pr_pl2 = event.reco_track_daughter_old_chi2pr_pl2[itrk][0];
	reco_track_daughter_old_chi2pi_pl2 = event.reco_track_daughter_old_chi2pi_pl2[itrk][0];
	reco_track_daughter_old_chi2mu_pl2 = event.reco_track_daughter_old_chi2mu_pl2[itrk][0];
	
	reco_track_daughter_old_chi2ka_3pl = event.reco_track_daughter_old_chi2ka_3pl[itrk][0];
	reco_track_daughter_old_chi2pr_3pl = event.reco_track_daughter_old_chi2pr_3pl[itrk][0];
	reco_track_daughter_old_chi2pi_3pl = event.reco_track_daughter_old_chi2pi_3pl[itrk][0];
	reco_track_daughter_old_chi2mu_3pl = event.reco_track_daughter_old_chi2mu_3pl[itrk][0];
	
	reco_track_daughter_old_llrpid_3pl = event.reco_track_daughter_old_llrpid_3pl[itrk][0];      
	reco_track_daughter_old_llrpid_k_3pl = event.reco_track_daughter_old_llrpid_k_3pl[itrk][0];      
	reco_track_daughter_old_true_pdg = event.reco_track_daughter_old_true_pdg[itrk][0];
	
	reco_track_daughter_old_vtx_inTPC = event.reco_track_daughter_old_vtx_inTPC[itrk][0];
	reco_track_daughter_old_vtx_in5cmTPC = event.reco_track_daughter_old_vtx_in5cmTPC[itrk][0];
	reco_track_daughter_old_vtx_inCCInclusiveTPC = event.reco_track_daughter_old_vtx_inCCInclusiveTPC[itrk][0];
	reco_track_daughter_old_end_inTPC = event.reco_track_daughter_old_end_inTPC[itrk][0];
	reco_track_daughter_old_end_in5cmTPC = event.reco_track_daughter_old_end_in5cmTPC[itrk][0];
	reco_track_daughter_old_end_inCCInclusiveTPC = event.reco_track_daughter_old_end_inCCInclusiveTPC[itrk][0];	
	
      }

      if(max_dau_length_index>=0){//retrieve rebuild track
	//else if(max_dau_length_index>=0){//retrieve rebuild track
	
	reco_track_daughter_length = event.reco_track_daughter_length[itrk][max_dau_length_index];
	reco_track_daughter_distance = event.reco_track_daughter_distance[itrk][max_dau_length_index];
	reco_track_daughter_vtx_distance = event.reco_track_daughter_vtx_distance[itrk][max_dau_length_index];
	reco_track_daughter_theta = event.reco_track_daughter_theta[itrk][max_dau_length_index];
	reco_track_daughter_phi = event.reco_track_daughter_phi[itrk][max_dau_length_index];
	
	reco_angle_track_daughter = event.reco_angle_track_daughter[itrk][max_dau_length_index];
	
	reco_track_daughter_chi2ka_pl0 = event.reco_track_daughter_chi2ka_pl0[itrk][max_dau_length_index];
	reco_track_daughter_chi2pr_pl0 = event.reco_track_daughter_chi2pr_pl0[itrk][max_dau_length_index];
	reco_track_daughter_chi2pi_pl0 = event.reco_track_daughter_chi2pi_pl0[itrk][max_dau_length_index];
	reco_track_daughter_chi2mu_pl0 = event.reco_track_daughter_chi2mu_pl0[itrk][max_dau_length_index];
	
	reco_track_daughter_chi2ka_pl1 = event.reco_track_daughter_chi2ka_pl1[itrk][max_dau_length_index];
	reco_track_daughter_chi2pr_pl1 = event.reco_track_daughter_chi2pr_pl1[itrk][max_dau_length_index];
	reco_track_daughter_chi2pi_pl1 = event.reco_track_daughter_chi2pi_pl1[itrk][max_dau_length_index];
	reco_track_daughter_chi2mu_pl1 = event.reco_track_daughter_chi2mu_pl1[itrk][max_dau_length_index];
	
	reco_track_daughter_chi2ka_pl2 = event.reco_track_daughter_chi2ka_pl2[itrk][max_dau_length_index];
	reco_track_daughter_chi2pr_pl2 = event.reco_track_daughter_chi2pr_pl2[itrk][max_dau_length_index];
	reco_track_daughter_chi2pi_pl2 = event.reco_track_daughter_chi2pi_pl2[itrk][max_dau_length_index];
	reco_track_daughter_chi2mu_pl2 = event.reco_track_daughter_chi2mu_pl2[itrk][max_dau_length_index];
	
	reco_track_daughter_chi2ka_3pl = event.reco_track_daughter_chi2ka_3pl[itrk][max_dau_length_index];
	reco_track_daughter_chi2pr_3pl = event.reco_track_daughter_chi2pr_3pl[itrk][max_dau_length_index];
	reco_track_daughter_chi2pi_3pl = event.reco_track_daughter_chi2pi_3pl[itrk][max_dau_length_index];
	reco_track_daughter_chi2mu_3pl = event.reco_track_daughter_chi2mu_3pl[itrk][max_dau_length_index];
	
	reco_track_daughter_llrpid_3pl = event.reco_track_daughter_llrpid_3pl[itrk][max_dau_length_index];      
	reco_track_daughter_llrpid_k_3pl = event.reco_track_daughter_llrpid_k_3pl[itrk][max_dau_length_index];      
	reco_track_daughter_true_pdg = event.reco_track_daughter_true_pdg[itrk][max_dau_length_index];
	//if(event.reco_track_true_pdg[itrk]==321) cout << "reco_track_daughter_true_pdg: " << reco_track_daughter_true_pdg << ", length: " << reco_track_daughter_length << endl;
	
	reco_track_daughter_vtx_inTPC = event.reco_track_daughter_vtx_inTPC[itrk][max_dau_length_index];
	reco_track_daughter_vtx_in5cmTPC = event.reco_track_daughter_vtx_in5cmTPC[itrk][max_dau_length_index];
	reco_track_daughter_vtx_inCCInclusiveTPC = event.reco_track_daughter_vtx_inCCInclusiveTPC[itrk][max_dau_length_index];
	reco_track_daughter_end_inTPC = event.reco_track_daughter_end_inTPC[itrk][max_dau_length_index];
	reco_track_daughter_end_in5cmTPC = event.reco_track_daughter_end_in5cmTPC[itrk][max_dau_length_index];
	reco_track_daughter_end_inCCInclusiveTPC = event.reco_track_daughter_end_inCCInclusiveTPC[itrk][max_dau_length_index];
      }
      }
	else{
	  //cout << "no daughter track" << endl;
	  reco_track_daughter_length = -9999;
	  reco_track_daughter_distance = -9999;
	  reco_track_daughter_vtx_distance = -9999;
	  reco_track_daughter_theta = -9999;
	  reco_track_daughter_phi = -9999;
	  reco_angle_track_daughter = -9999;
	  reco_track_daughter_chi2ka_pl0 = -9999;
	  reco_track_daughter_chi2pr_pl0 = -9999;
	  reco_track_daughter_chi2pi_pl0 = -9999;
	  reco_track_daughter_chi2mu_pl0 = -9999;
	  reco_track_daughter_chi2ka_pl1 = -9999;
	  reco_track_daughter_chi2pr_pl1 = -9999;
	  reco_track_daughter_chi2pi_pl1 = -9999;
	  reco_track_daughter_chi2mu_pl1 = -9999;
	  reco_track_daughter_chi2ka_pl2 = -9999;
	  reco_track_daughter_chi2pr_pl2 = -9999;
	  reco_track_daughter_chi2pi_pl2 = -9999;
	  reco_track_daughter_chi2mu_pl2 = -9999;
	  reco_track_daughter_chi2ka_3pl = -9999;
	  reco_track_daughter_chi2pr_3pl = -9999;
	  reco_track_daughter_chi2pi_3pl = -9999;
	  reco_track_daughter_chi2mu_3pl = -9999;
	  reco_track_daughter_llrpid_3pl = -9999;
	  reco_track_daughter_llrpid_k_3pl = -9999;
	  reco_track_daughter_true_pdg = -9999;
	  reco_track_daughter_vtx_inTPC = false;
	  reco_track_daughter_vtx_in5cmTPC = false;
	  reco_track_daughter_vtx_inCCInclusiveTPC = false;
	  reco_track_daughter_end_inTPC = false;
	  reco_track_daughter_end_in5cmTPC = false;
	  reco_track_daughter_end_inCCInclusiveTPC= false;

	  reco_track_daughter_old_length = -9999;
	  reco_track_daughter_old_distance = -9999;
	  //reco_track_daughter_old_vtx_distance = -9999;
	  reco_track_daughter_old_theta = -9999;
	  reco_track_daughter_old_phi = -9999;
	  reco_angle_track_daughter = -9999;
	  reco_track_daughter_old_chi2ka_pl0 = -9999;
	  reco_track_daughter_old_chi2pr_pl0 = -9999;
	  reco_track_daughter_old_chi2pi_pl0 = -9999;
	  reco_track_daughter_old_chi2mu_pl0 = -9999;
	  reco_track_daughter_old_chi2ka_pl1 = -9999;
	  reco_track_daughter_old_chi2pr_pl1 = -9999;
	  reco_track_daughter_old_chi2pi_pl1 = -9999;
	  reco_track_daughter_old_chi2mu_pl1 = -9999;
	  reco_track_daughter_old_chi2ka_pl2 = -9999;
	  reco_track_daughter_old_chi2pr_pl2 = -9999;
	  reco_track_daughter_old_chi2pi_pl2 = -9999;
	  reco_track_daughter_old_chi2mu_pl2 = -9999;
	  reco_track_daughter_old_chi2ka_3pl = -9999;
	  reco_track_daughter_old_chi2pr_3pl = -9999;
	  reco_track_daughter_old_chi2pi_3pl = -9999;
	  reco_track_daughter_old_chi2mu_3pl = -9999;
	  reco_track_daughter_old_llrpid_3pl = -9999;
	  reco_track_daughter_old_llrpid_k_3pl = -9999;
	  reco_track_daughter_old_true_pdg = -9999;
	  reco_track_daughter_old_vtx_inTPC = false;
	  reco_track_daughter_old_vtx_in5cmTPC = false;
	  reco_track_daughter_old_vtx_inCCInclusiveTPC = false;
	  reco_track_daughter_old_end_inTPC = false;
	  reco_track_daughter_old_end_in5cmTPC = false;
	  reco_track_daughter_old_end_inCCInclusiveTPC= false;
	  
	}
	
      /*
      if(reco_track_daughter_true_pdg==211){
	cout << "rebdautrack_length[itrk][idau]: " << reco_track_daughter_length << endl;
	cout << "After Access 2: " << event.reco_track_daughter_old_true_pdg[itrk][0] << ", Length=" << event.reco_track_daughter_old_length[itrk][0] << endl;
	cout << "reco_track_daughter_old_true_pdg[itrk][0]: " << reco_track_daughter_old_true_pdg << ", reco_track_daughter_old_length[itrk][0]" << reco_track_daughter_old_length << endl;
      }
      */

      //}
      
      if(reco_track_daughter_end_in5cmTPC == false) continue;
      //if(reco_track_daughter_length<0) continue;


      /*
      if(event.reco_track_true_pdg[itrk]==321 && ( event.reco_track_daughter_true_pdg[itrk][0]==-13 || event.reco_track_daughter_true_pdg[itrk][0]==211)  && event.reco_nu_vtx_inCCInclusiveTPC==true){
	true_cut1++;
	if(event.reco_track_end_inCCInclusiveTPC[itrk]==true){
	  true_cut2++;
	  if(reco_track_daughter_end_in5cmTPC==true){
	    true_cut3++;
	  }
	}    
      }
      */

      //if (event.reco_track_end_inCCInclusiveTPC[itrk]==false) continue;
      //if (event.reco_track_ndaughters[itrk] != 1) continue;
      //if (event.reco_track_daughter_end_in5cmTPC[itrk][0]==false) continue;

      /*
      if(
	 (event.run==7006 && event.subrun==70 && event.event==3528)
	 || (event.run==5025 || event.subrun==134 || event.event==6738)
	 )
	{
      */
	  //}

      //if (event.reco_track_true_pdg[itrk] == -9999) continue;
      //if (event.reco_track_true_pdg[itrk] != 321) continue;
      //if (event.reco_track_vtx_inTPC[itrk]==false) continue;

      //if (event.reco_track_daughter_vtx_inTPC[itrk][0]==false) continue;
      //if (event.reco_track_daughter_true_pdg[itrk][0] == -9999) continue;
      //if (event.reco_track_daughter_true_pdg[itrk][0] != -13 && event.reco_track_daughter_true_pdg[itrk][0] != 211) continue;
      
      true_nu_energy = event.true_nu_energy;
      true_kaon_length = event.true_kaon_length;
      true_kaon_daughter_length = event.true_kaon_daughter_length;
      true_kaon_p = event.true_kaon_p;
      true_kaon_ke = event.true_kaon_ke;
      true_kaon_theta = event.true_kaon_theta;
      true_kaon_costheta = event.true_kaon_costheta;
      true_kaon_phi = event.true_kaon_phi;

      true_dau_pip_length = event.true_dau_pip_length;
      true_dau_muon_length = event.true_dau_muon_length;

      eventnum = event.event;
      run = event.run;
      subrun = event.subrun;
      true_nu_pdg = event.true_nu_pdg;
      true_nu_ccnc = event.true_nu_ccnc;
      true_nu_mode = event.true_nu_mode;
      true_lepton_pdg = event.true_lepton_pdg;
      true_nkaons = event.true_nkaons;
      true_nhyperons = event.true_nhyperons;
      reco_ccmu_true_pdg = event.reco_ccmu_true_pdg;

      true_kaon_end_process  = event.true_kaon_end_process;
      reco_track_nhits0 = event.reco_track_nhits0[itrk];
      reco_track_nhits1 = event.reco_track_nhits1[itrk];
      reco_track_nhits2 = event.reco_track_nhits2[itrk];
      
      reco_track_distance = event.reco_track_distance[itrk];
      reco_track_vtx_distance = event.reco_track_vtx_distance[itrk];
      reco_track_length = event.reco_track_length[itrk];
      reco_track_theta = event.reco_track_theta[itrk];
      reco_track_phi = event.reco_track_phi[itrk];
      
      reco_track_log_bragg_peak = log(event.reco_track_MIP_pl2[itrk]/event.reco_track_Bragg_fwd_pr_pl2[itrk]);
      reco_track_Bragg_fwd_ka_pl0 = event.reco_track_Bragg_fwd_ka_pl0[itrk];
      reco_track_Bragg_fwd_pr_pl0 = event.reco_track_Bragg_fwd_pr_pl0[itrk];
      reco_track_Bragg_fwd_pi_pl0 = event.reco_track_Bragg_fwd_pi_pl0[itrk];
      reco_track_Bragg_fwd_mu_pl0 = event.reco_track_Bragg_fwd_mu_pl0[itrk];
      reco_track_Bragg_fwd_ka_pl1 = event.reco_track_Bragg_fwd_ka_pl1[itrk];
      reco_track_Bragg_fwd_pr_pl1 = event.reco_track_Bragg_fwd_pr_pl1[itrk];
      reco_track_Bragg_fwd_pi_pl1 = event.reco_track_Bragg_fwd_pi_pl1[itrk];
      reco_track_Bragg_fwd_mu_pl1 = event.reco_track_Bragg_fwd_mu_pl1[itrk];
      reco_track_Bragg_fwd_ka_pl2 = event.reco_track_Bragg_fwd_ka_pl2[itrk];
      reco_track_Bragg_fwd_pr_pl2 = event.reco_track_Bragg_fwd_pr_pl2[itrk];
      reco_track_Bragg_fwd_pi_pl2 = event.reco_track_Bragg_fwd_pi_pl2[itrk];
      reco_track_Bragg_fwd_mu_pl2 = event.reco_track_Bragg_fwd_mu_pl2[itrk];
      
      reco_track_MIP_pl0 = event.reco_track_MIP_pl0[itrk];
      reco_track_MIP_pl1 = event.reco_track_MIP_pl1[itrk];
      reco_track_MIP_pl2 = event.reco_track_MIP_pl2[itrk];
      
      reco_track_chi2ka_pl0 = event.reco_track_chi2ka_pl0[itrk];
      reco_track_chi2pr_pl0 = event.reco_track_chi2pr_pl0[itrk];
      reco_track_chi2pi_pl0 = event.reco_track_chi2pi_pl0[itrk];
      reco_track_chi2mu_pl0 = event.reco_track_chi2mu_pl0[itrk];
      
      reco_track_chi2ka_pl1 = event.reco_track_chi2ka_pl1[itrk];
      reco_track_chi2pr_pl1 = event.reco_track_chi2pr_pl1[itrk];
      reco_track_chi2pi_pl1 = event.reco_track_chi2pi_pl1[itrk];
      reco_track_chi2mu_pl1 = event.reco_track_chi2mu_pl1[itrk];
      
      reco_track_chi2ka_pl2 = event.reco_track_chi2ka_pl2[itrk];
      reco_track_chi2pr_pl2 = event.reco_track_chi2pr_pl2[itrk];
      reco_track_chi2pi_pl2 = event.reco_track_chi2pi_pl2[itrk];
      reco_track_chi2mu_pl2 = event.reco_track_chi2mu_pl2[itrk];
      
      reco_track_chi2ka_3pl = event.reco_track_chi2ka_3pl[itrk];
      reco_track_chi2pr_3pl = event.reco_track_chi2pr_3pl[itrk];
      reco_track_chi2pi_3pl = event.reco_track_chi2pi_3pl[itrk];
      reco_track_chi2mu_3pl = event.reco_track_chi2mu_3pl[itrk];
      
      reco_track_llrpid_3pl = event.reco_track_llrpid_3pl[itrk];
      reco_track_llrpid_k_3pl = event.reco_track_llrpid_k_3pl[itrk];
      reco_track_true_pdg = event.reco_track_true_pdg[itrk];
      
      true_nu_vtx_inCCInclusiveTPC = event.true_nu_vtx_inCCInclusiveTPC;
      true_kaon_end_inCCInclusiveTPC = event.true_kaon_end_inCCInclusiveTPC;
      true_kaon_daughter_end_in5cmTPC = event.true_kaon_daughter_end_in5cmTPC;

      reco_track_vtx_inTPC = event.reco_track_vtx_inTPC[itrk];
      reco_track_vtx_in5cmTPC = event.reco_track_vtx_in5cmTPC[itrk];
      reco_track_vtx_inCCInclusiveTPC = event.reco_track_vtx_inCCInclusiveTPC[itrk];
      reco_track_end_inTPC = event.reco_track_end_inTPC[itrk];
      reco_track_end_in5cmTPC = event.reco_track_end_in5cmTPC[itrk];
      reco_track_end_inCCInclusiveTPC = event.reco_track_end_inCCInclusiveTPC[itrk];
      reco_track_ndaughters = event.reco_track_ndaughters[itrk];
      //reco_track_ndaughters_old = event.reco_track_ndaughters_old[itrk];
	

    

      reco_track_kin0 = event.reco_track_kin0[itrk];
      reco_track_kin1 = event.reco_track_kin1[itrk];
      reco_track_kin2 = event.reco_track_kin2[itrk];

      reco_track_P_vtx = event.reco_track_P_vtx[itrk];
      reco_track_P_str = event.reco_track_P_str[itrk];
      reco_track_P_end = event.reco_track_P_end[itrk];


      
      outtree->Fill();
      // Reset track-level variables
      reco_track_daughter_old_true_pdg = -9999;
      reco_track_daughter_old_length = -9999;
      reco_track_daughter_true_pdg = -9999;
      reco_track_daughter_length = -9999;
      reco_track_chi2ka_pl0 = -9999;
      reco_track_chi2pr_pl0 = -9999;
      reco_track_chi2pi_pl0 = -9999;
      reco_track_chi2mu_pl0 = -9999;
      reco_track_chi2ka_pl1 = -9999;
      reco_track_chi2pr_pl1 = -9999;
      reco_track_chi2pi_pl1 = -9999;
      reco_track_chi2mu_pl1 = -9999;
      reco_track_chi2ka_pl2 = -9999;
      reco_track_chi2pr_pl2 = -9999;
      reco_track_chi2pi_pl2 = -9999;
      reco_track_chi2mu_pl2 = -9999;
      reco_track_chi2ka_3pl = -9999;
      reco_track_chi2pr_3pl = -9999;
      reco_track_chi2pi_3pl = -9999;
      reco_track_chi2mu_3pl = -9999;
      reco_track_llrpid_3pl = -9999;
      reco_track_llrpid_k_3pl = -9999;
      reco_track_true_pdg = -9999;
      reco_track_daughter_vtx_inTPC = false;
      reco_track_daughter_vtx_in5cmTPC = false;
      reco_track_daughter_vtx_inCCInclusiveTPC = false;
      reco_track_daughter_end_inTPC = false;
      reco_track_daughter_end_in5cmTPC = false;
      reco_track_daughter_end_inCCInclusiveTPC = false;
      reco_track_daughter_old_vtx_inTPC = false;
      reco_track_daughter_old_vtx_in5cmTPC = false;
      reco_track_daughter_old_vtx_inCCInclusiveTPC = false;
      reco_track_daughter_old_end_inTPC = false;
      reco_track_daughter_old_end_in5cmTPC = false;
      reco_track_daughter_old_end_inCCInclusiveTPC = false;

    }//end loop over tracks

    // Reset event-level variables
    true_nu_energy = -9999;
    true_kaon_length = -9999;
    true_kaon_daughter_length = -9999;
    true_kaon_p = -9999;
    true_kaon_ke = -9999;
    true_kaon_theta = -9999;
    true_kaon_costheta = -9999;
    true_kaon_phi = -9999;
    true_dau_pip_length = -9999;
    true_dau_muon_length = -9999;
    true_nu_pdg = -9999;
    true_nu_ccnc = -9999;
    true_nu_mode = -9999;
    true_lepton_pdg = -9999;
    true_nkaons = -9999;
    true_nhyperons = -9999;
    true_kaon_end_process = -9999;
    true_nu_vtx_inCCInclusiveTPC = false;
    true_kaon_end_inCCInclusiveTPC = false;
    true_kaon_daughter_end_in5cmTPC = false;

  }//tree loop

  cout << true_cut1 << " " << true_cut2 << " " << true_cut3 << endl;

  outfile->Write();
  outfile->Close();
  delete outfile;
  cout << "n_true_k: " << n_true_k << endl;
  cout << "process end" << endl;
}


